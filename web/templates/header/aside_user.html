<?php
// Data
exec (HESTIA_CMD."v-list-sys-info json", $output, $return_var);
$sys = json_decode(implode('', $output), true);
unset($output);
?>
<aside class="menu right desktop-hide">
  <div class="backdrop" data-action="close-right-menu"></div>
  <div class="contents">
    <div class="panel">
      <div class="js_control">
        <span class="menu-toggle-square" data-action="menu-right-close"><i class="fa fa-times"></i></span>
        <?php if (($_SESSION['userContext'] === 'admin') && (isset($_SESSION['look']) && ($user == 'admin'))) {?>
          <a href="/list/log/" class="<?php if($TAB == 'LOG') echo 'active' ?>"><i class="fas fa-clock-rotate-left"></i> <?=_('Logs');?></a>
        <?php } ?>
        <?php if ($panel[$user]['SUSPENDED'] === 'no') {?>
          <div class="context-user">
            <i class="fas fa-circle-user"></i>
            <span><?=htmlspecialchars($user)?> (<?=htmlspecialchars($panel[$user]['NAME'])?>)</span>
          </div>
          <a href="/edit/user/?user=<?=$user; ?>&token=<?=$_SESSION['token']?>"  class="menu-toggle-square">
            <i class="fas fa-pencil"></i>
          </a>
        <?php } ?>
      </div>
    </div>
    <div class="sub_panel">
      <div class="usage_card">
        <div class="legend">
          <span><?=_("Disk")?></span>
        </div>
        <div class="constant">
          <b><?=humanize_usage_size($panel[$user]['U_DISK'])?></b> <?=humanize_usage_measure($panel[$user]['U_DISK'])?>
        </div>
      </div>
      <div class="usage_card">
        <div class="legend">
          <span><?=_("Bandwidth")?></span>
        </div>
        <div class="constant">
          <b><?=humanize_usage_size($panel[$user]['U_BANDWIDTH'])?></b> <?=humanize_usage_measure($panel[$user]['U_BANDWIDTH'])?>
        </div>
      </div>
    </div>
    <ul class="mobile_menu">
      <?php if (($_SESSION['userContext'] === 'admin') && ($_SESSION['POLICY_SYSTEM_HIDE_SERVICES'] !== 'yes') || ($_SESSION['user'] === 'admin')) {?>
        <?php if (($_SESSION['userContext'] === 'admin') && (!empty($_SESSION['look']))) {?>
          <!-- Hide 'Server Settings' button when impersonating 'admin' or other users -->
        <?php } else { ?>
          <li class="nav-item">
            <a title="<?=_('Server');?>" class="nav-link <?php if(in_array($TAB, ['SERVER', 'IP', 'RRD', 'FIREWALL'])) echo 'active' ?>" href="/list/server/">
              <i class="fas fa-gear"></i>
              <span class=""><?=_('Server');?></span>
            </a>
            <div class="opener">
              <div class="box-icon" data-action="open-submenu">
                <i class="fa fa-chevron-right"></i>
              </div>
            </div>
            <ul class="sub-menu">
              <li class="nav-item">
                <div class="l-unit__stat-col l-unit__stat-col--right">
                <?php if ($sys['sysinfo']['RELEASE'] != 'release') { ?>
                  <i class="fas fa-flask icon-large status-icon red" title="<?=$sys['sysinfo']['RELEASE'];?>"></i>
                <?php } ?>
                <?php if ($sys['sysinfo']['RELEASE'] == 'release') { ?>
                  <i class="fas fa-cube icon-large status-icon" title="<?=_('Production release');?>"></i>
                <?php } ?>
                &nbsp;v<?=$sys['sysinfo']['HESTIA']?></div>
              </li>
            </ul>
          </li>
        <?php } ?>
      <?php } ?>
      <!-- Help / Documentation-->
      <li class="nav-item">
        <a title="<?=_('Help');?>" class="nav-link" href="https://docs.hestiacp.com/" target="_blank" rel="noopener">
          <i class="fas fa-circle-question"></i>
          <span class=""><?=_('Help');?></span>
        </a>
      </li>
      <!-- Logout -->
      <?php if (isset($_SESSION['look']) && (!empty($_SESSION['look']))) { ?>
        <li class="nav-item">
          <a title="<?=_('Log out');?> (<?=$user?>)" class="nav-link nav-link-logout" href="/logout/?token=<?=$_SESSION['token']?>">
            <i class="fas fa-circle-up"></i>
            <span class=""><?=_('Log out');?> (<?=$user?>)</span>
          </a>
        </li>
      <?php } else { ?>
        <li class="nav-item">
          <a title="<?=_('Log out');?>" class="nav-link nav-link-logout" href="/logout/?token=<?=$_SESSION['token']?>">
            <i class="fas fa-right-from-bracket"></i>
            <span class=""><?=_('Log out');?></span>
          </a>
        </li>
      <?php } ?>
    </ul>
  </div>
</aside>
